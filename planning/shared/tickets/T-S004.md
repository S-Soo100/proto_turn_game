# 내 프로필 수정 기능 (닉네임 등)

| 항목 | 값 |
|---|---|
| **ID** | T-S004 |
| **에픽** | — |
| **게임** | shared |
| **상태** | in-progress |
| **우선순위** | medium |
| **담당** | claude |
| **생성일** | 2026-02-28 |
| **수정일** | 2026-02-28 |
| **브랜치** | feature/T-S004-profile-edit |
| **의존** | — |
| **차단** | — |

---

## 요약

홈 화면에서 내 프로필 정보를 수정할 수 있는 기능을 추가한다. 프로필 카드를 탭하면 수정 바텀시트가 열리고, 수정 가능한 필드를 편집할 수 있다.

## 현재 상태

### `profiles` 테이블 컬럼 분류

**수정 가능 (이 티켓 대상)**:
| 컬럼 | 타입 | 현재 UI | 설명 |
|---|---|---|---|
| `username` | TEXT UNIQUE (3-20자) | 프로필 카드에 표시 중 | 닉네임 |
| `avatar_url` | TEXT | 미사용 (첫 글자 아바타) | 프로필 이미지 URL |
| `preferred_pace` | game_pace ('quick'/'standard'/'slow') | 미사용 | 선호 게임 속도 |
| `notifications_enabled` | BOOLEAN | 미사용 | 알림 설정 |
| `email_notifications` | BOOLEAN | 미사용 | 이메일 알림 설정 |

**수정 불가 (시스템 관리)**:
- `id`, `created_at`, `updated_at`
- `total_games`, `games_won`, `games_lost`, `games_drawn`
- `elo_rating`, `peak_rating`
- `last_seen_at`, `is_banned`, `ban_reason`

### RLS 정책
```sql
-- 이미 존재: 본인 프로필만 UPDATE 가능
CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = id);
```

DB 변경 없음 — RLS가 이미 UPDATE를 허용한다.

---

## 상세 설명

### 진입점
- 홈 화면 `ProfileCard`를 탭하면 프로필 수정 바텀시트가 열림
- 카드 우측에 연필 아이콘(✏️) 또는 ">" 표시로 수정 가능함을 안내

### 프로필 수정 바텀시트

```
┌───────────────────────────────┐
│  ── (handle) ──              │
│                               │
│  프로필 수정                   │
│                               │
│  닉네임                       │
│  ┌─────────────────────────┐ │
│  │ 현재 닉네임              │ │
│  └─────────────────────────┘ │
│  3~20자, 영문/한글/숫자       │
│                               │
│  [저장]                       │
│  [취소]                       │
└───────────────────────────────┘
```

### 수정 가능 필드 (1차 스코프)

| 필드 | UI 형태 | 유효성 검증 |
|---|---|---|
| 닉네임 (`username`) | 텍스트 입력 | 3~20자, 빈 값 불가, 중복 시 에러 표시 |

> `avatar_url`, `preferred_pace`, `notifications_enabled`, `email_notifications`은 추후 확장 가능하나 **1차 스코프에서는 닉네임만** 구현

### 저장 로직

1. 유효성 검증 (3~20자, 빈 값 체크)
2. `supabase.from('profiles').update({ username }).eq('id', profile.id)`
3. 성공 시: authStore의 profile 갱신 + 바텀시트 닫기 + 성공 토스트
4. 실패 시 (중복 닉네임 등): 에러 메시지 표시
   - UNIQUE 제약 위반 → "이미 사용 중인 닉네임입니다"

### authStore 확장

- `updateProfile(updates: Partial<Profile>)` 메서드 추가
- Supabase UPDATE 호출 + 로컬 상태 갱신

---

## 수정할 파일 목록

| 파일 | 변경 내용 |
|---|---|
| `src/store/authStore.ts` | `updateProfile()` 메서드 추가 |
| `src/pages/HomePage.tsx` | ProfileCard 탭 이벤트 + 프로필 수정 바텀시트 UI |

## 수락 기준

- [ ] 프로필 카드 탭 시 수정 바텀시트 오픈
- [ ] 닉네임 수정 + 저장 시 DB 반영 + UI 즉시 갱신
- [ ] 유효성 검증: 3~20자, 빈 값 불가
- [ ] 중복 닉네임 에러 메시지 표시
- [ ] 수정 불가 필드(ELO, 게임 수 등)는 편집 불가
- [ ] DB 변경 없음 (기존 RLS 활용)
- [ ] `pnpm build` 성공

## 메모

- 추후 아바타 이미지 업로드, 게임 속도 설정, 알림 설정 등은 별도 티켓으로 확장
- Supabase Storage의 `avatars` 버킷이 이미 생성되어 있으므로 아바타 기능 확장이 용이
