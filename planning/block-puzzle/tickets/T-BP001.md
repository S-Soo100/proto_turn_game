# 블록 퍼즐 게임 로직 구현

| 항목 | 값 |
|---|---|
| **ID** | T-BP001 |
| **에픽** | E-BP001 |
| **게임** | block-puzzle |
| **상태** | draft |
| **우선순위** | high |
| **담당** | claude |
| **생성일** | 2026-02-27 |
| **수정일** | 2026-02-27 |
| **브랜치** | feature/T-BP001-block-puzzle-logic |
| **의존** | — |
| **차단** | T-BP002 |

---

## 요약

8x8 격자 기반 블록 퍼즐의 순수 게임 로직을 구현한다. 격자 관리, 블록 조각 정의, 배치 판정, 줄 완성/제거, 점수 계산, 게임 오버 판정을 포함.

## 상세 설명

`src/lib/game-logic/block-puzzle.ts` 파일을 생성하여, 기존 tictactoe.ts / gomoku.ts와 동일한 순수 함수 패턴으로 구현.

### 핵심 모듈
1. **격자 상태**: 8x8 2D 배열 (또는 64칸 flat 배열), 각 셀은 색상 또는 null
2. **블록 조각**: 10~15종 테트로미노 + 변형 셰이프 정의 (상대 좌표 배열)
3. **배치 판정**: `canPlace(grid, piece, row, col)` → boolean
4. **배치 실행**: `placePiece(grid, piece, row, col)` → 새 격자
5. **줄 완성**: `getCompletedLines(grid)` → { rows: number[], cols: number[] }
6. **줄 제거**: `clearLines(grid, rows, cols)` → 새 격자
7. **점수 계산**: 줄 수에 따른 점수 (콤보 보너스)
8. **게임 오버**: `isGameOver(grid, pieces)` → boolean (3개 블록 모두 배치 불가)
9. **블록 생성**: `generatePieces()` → 랜덤 3개 블록 조각

## 구현 가이드

### 수정할 파일
| 파일 | 변경 내용 |
|---|---|
| `src/lib/game-logic/block-puzzle.ts` | **신규** — 전체 게임 로직 |

### 참고 패턴
- `tictactoe.ts`의 구조를 따름: 타입 정의 → 상수 → 순수 함수 → 내보내기
- 격자는 gomoku.ts처럼 flat 배열 사용 고려 (기존 패턴 일관성)

### 블록 조각 예시
```typescript
// 상대 좌표 배열로 정의
const PIECES = [
  { shape: [[0,0], [0,1], [1,0], [1,1]], color: '#f59e0b' },  // 2x2 정사각형
  { shape: [[0,0], [0,1], [0,2], [0,3]], color: '#3b82f6' },  // 1x4 가로막대
  { shape: [[0,0], [1,0], [2,0], [2,1]], color: '#ef4444' },  // L자
  // ...
]
```

## 수락 기준

- [ ] 8x8 격자 상태 생성/관리 함수 동작
- [ ] 10종 이상 블록 조각 정의 완료
- [ ] `canPlace` / `placePiece` 정확히 동작
- [ ] 가로/세로 줄 완성 시 `getCompletedLines`가 올바르게 감지
- [ ] `clearLines`로 줄 제거 후 격자 상태 정확
- [ ] 점수 계산 로직 (1줄=100, 2줄=300, 3줄=600 등 콤보)
- [ ] `isGameOver`가 3개 블록 모두 배치 불가 시 true 반환
- [ ] `pnpm build` 성공

## 관련 유즈케이스

| ID | 제목 |
|---|---|
| UC-BP001 | 블록 배치 + 줄 제거 기본 플로우 |
| UC-BP002 | 게임 오버 + 재시작 |

## 메모

- 블록 조각은 회전 없음 (Block Blast 스타일 — 주어진 모양 그대로 배치)
- 색상은 블록별로 고정 (배치 후 격자에 색상 유지)
