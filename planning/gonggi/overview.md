# 공기놀이 (Gonggi) Overview

| 항목 | 값 |
|---|---|
| **ID** | gonggi |
| **상태** | planning |

---

## 게임 개요

> **"공기놀이 게임 같아 보이는 열받는 게임"**
>
> 겉보기엔 정상적인 공기놀이지만, 라운드가 진행될수록 예측 불가능한 변칙 룰이 끼어들어 플레이어를 열받게 만드는 싱글 플레이 트롤 게임. 1~2라운드는 정상 플레이가 가능하지만, 이후 점점 미쳐가는 이벤트들이 터진다. 클리어 시간은 리더보드에 기록된다.

## 게임 모드

| 항목 | 값 |
|---|---|
| **싱글 플레이** | 유일한 게임 모드 (변칙 룰 항상 적용) |
| **멀티플레이** | 없음 |
| **정상 모드** | 없음 (변칙 룰이 곧 게임의 본질) |
| **리더보드** | 클리어 시간 기준 순위표 |

## 게임 컨셉

### 핵심 아이덴티티
- **표면**: 진지한 공기놀이 게임
- **실체**: 열받는 트롤 게임
- 플레이어는 처음에 "오 공기놀이네" → 몇 라운드 후 "뭐야 이게?!" → "아 열받아!!" 감정 곡선
- 변칙 룰 때문에 시간이 늘어남 → 리더보드에서 빠른 클리어 시간을 노리는 재도전 유도

### 라운드 구조
- **라운드 1~2**: 정상적인 공기놀이 (신뢰 구축 구간)
- **라운드 3+**: 변칙 룰이 랜덤으로 발동 (확률 점점 증가)
- 변칙 룰은 `planning/gonggi/chaos-rules/` 에서 별도 관리

## 기본 메카닉 (정상 공기놀이)

- 5개의 공깃돌을 바닥에 뿌림
- 1단: 공깃돌 1개를 위로 던지고, 바닥의 돌 1개를 집은 뒤, 떨어지는 돌을 받음 (4회 반복)
- 2단: 2개씩 집기 (2회 반복)
- 3단: 3개 + 1개 집기
- 4단: 4개 한번에 집기
- 5단 (꺾기): 5개를 위로 던져 손등으로 받고, 다시 던져 잡기
- 실패 시 해당 단계 재시도

## 변칙 룰 시스템

### 발동 조건
| 라운드 | 변칙 발동 확률 | 비고 |
|---|---|---|
| 1~2 | 0% | 정상 플레이 (신뢰 구축) |
| 3 | 30% | 슬슬 시작 |
| 4 | 50% | 본격 시작 |
| 5+ | 70~90% | 거의 매번 발동 |

### 발동 타이밍
- `after-toss` — 돌을 던진 직후
- `before-pick` — 돌을 집으려는 순간
- `before-success` — 성공 직전 (가장 열받는 타이밍)
- `stage-transition` — 단계 전환 시
- `during-play` — 플레이 도중 상시

### 변칙 룰 목록
별도 문서로 관리: `planning/gonggi/chaos-rules/`

| ID | 이름 | 타이밍 | 요약 |
|---|---|---|---|
| CR-GG001 | 새가 된 공기 | `after-toss` | 던진 돌이 🐦로 변해서 날아감 |
| CR-GG002 | 고양이 습격 | `before-success` | 성공 직전 🐾이 돌을 다 쳐냄 |
| CR-GG003 | 돌멩이의 자아 | `before-pick` | 돌에 👀이 생기고 도망감 |
| CR-GG004 | 가짜 클리어 | `stage-transition` | 축하 연출 후 "아직이요 ㅋ" 되감기 |
| CR-GG005 | 무한 증식 | `after-toss` | 던진 돌이 3개로 쪼개짐 (진짜는 1개) |
| CR-GG007 | 관객 야유 | `during-play` | 탄막 야유 댓글이 화면에 흘러감 |
| CR-GG008 | 화면 뒤집기 | `stage-transition` | 화면 180도 회전, 조작 반전 |

## 시각 표현 (확정)

| 항목 | 값 |
|---|---|
| **뷰 방식** | 2.5D (CSS perspective + rotateX) |
| **그래픽** | Mock-up 스타일로 시작 → 나중에 에셋 교체 |
| **돌 표현** | 단순 원형 (그라데이션 + 그림자로 입체감) |
| **바닥면** | `perspective(800px) rotateX(45deg)` 기울어진 평면 |

### Mock-up → 에셋 교체 전략
- 돌: `div` 원형 + `radial-gradient` → 나중에 `<img>` 또는 SVG로 교체
- 바닥: 단색 평면 → 나중에 텍스처 이미지로 교체
- 손: CSS 실루엣 → 나중에 스프라이트로 교체

## 물리 엔진 (확정)

| 항목 | 값 |
|---|---|
| **라이브러리** | matter.js |
| **용도** | 돌 뿌리기 산란, 충돌, 포물선 궤적, 바운스 |
| **렌더링** | matter.js 물리 계산 → React DOM 렌더링 (Canvas 미사용) |

### matter.js 활용 범위
- 돌 뿌리기: 중력 + 충돌로 자연스러운 산란
- 던지기: 속도/방향에 따른 포물선 궤적
- 떨어지기: 중력 + 바닥 충돌 바운스
- 돌끼리 부딪힘: 리얼한 충돌 반응

## 보드 구조

| 항목 | 값 |
|---|---|
| 격자 크기 | 격자 없음 (자유 위치) |
| 셀 표현 | 공깃돌 5개의 x, y 좌표 (matter.js Body 연동) |
| 데이터 구조 | `{ stones: {x, y, bodyId}[], inHand: number, stage: 1-5, tossed: boolean }` |

## 승리 조건 + 리더보드

- 변칙 룰을 뚫고 1단~5단 클리어 시 **성공**
- 클리어하면 트롤 엔딩 ("축하합니다... 진짜로?")
- **리더보드 기록 항목**:

| 항목 | 설명 |
|---|---|
| 클리어 시간 | 게임 시작 ~ 5단 클리어까지 총 소요 시간 (리더보드 정렬 기준) |
| 실패 횟수 | 단계 실패 + 변칙 룰에 당한 횟수 |
| 변칙 생존 | 변칙 룰이 발동했지만 클리어에 성공한 횟수 |
| 플레이 일시 | 기록 시점 |
| 닉네임 | 프로필 닉네임 |

### 리더보드 UI
- 게임 결과 화면에서 바로 리더보드 진입
- `/gonggi/leaderboard` 라우트 (또는 결과 화면 내 탭)
- 표 형태로 상위 기록 표시 (클리어 시간 ASC 정렬)
- 내 기록 하이라이트

## 기술 구성

| 파일 | 역할 |
|---|---|
| `src/lib/game-logic/gonggi.ts` | 게임 로직 (단계 진행, 성공/실패 판정) |
| `src/lib/game-logic/gonggi-chaos.ts` | 변칙 룰 시스템 (발동 판정, 이벤트 실행) |
| `src/lib/game-logic/gonggi.test.ts` | Unit 테스트 |
| `src/components/game/GonggiBoard.tsx` | 보드 컴포넌트 (2.5D + matter.js 물리) |
| `src/components/game/GonggiBoard.test.tsx` | Integration 테스트 |
| `src/lib/physics/gonggi-physics.ts` | matter.js 물리 엔진 래퍼 |
| `src/components/game/GonggiLeaderboard.tsx` | 리더보드 컴포넌트 |

## 에픽 목록

| ID | 제목 | 상태 |
|---|---|---|
| E-GG001 | 공기놀이 MVP (게임 로직 + 보드 + 변칙 룰 + 리더보드) | draft |

## 조작 방식 (확정)

### 1. 타이밍 기반 제한시간
- 각 동작(던지기, 집기, 잡기)에 **제한시간**이 존재
- 제한시간 내에 조작을 완료하지 못하면 **실패** 처리
- 단계가 올라갈수록 제한시간이 짧아져 난이도 상승

### 2. 스와이프-투-캐치 (바닥 돌 집기)
- 화면 한 곳에서 **탭/클릭으로 시작**
- 잡아야 하는 공깃돌을 **한 획에 선을 그리듯이** 이어서 long-press로 묶기
- 낚아채듯 연결하는 조작감 — 돌 사이를 끊김 없이 드래그해야 함
- 구현: `pointerdown` → `pointermove`(돌 위를 지나가면 선택) → `pointerup`(선택 확정)
- 시각 피드백: 드래그 경로에 잔상 라인 + 선택된 돌 하이라이트

### 3. 플릭-투-토스 (돌 던지기)
- 공깃돌을 **눌러서 위로 휙 올리는** 제스처
- **쫀득한 조작감**: 누르면 돌이 살짝 눌리고(스쿼시), 떼는 순간 탄성으로 튀어오름
- 플릭 속도/방향에 따라 던지기 높이와 체공 시간이 달라짐
- 구현: `pointerdown`(스쿼시 시작) → `pointermove`(위로 드래그) → `pointerup`(발사, 속도 계산)
- 시각 피드백: 스쿼시 → 스트레치 → 포물선 궤적 애니메이션

## 밸런스 파라미터 (초기값 → 플레이테스트로 튜닝)

### 제한시간 (ms)
| 단계 | 던지기 | 집기 | 잡기 |
|---|---|---|---|
| 1단 | 3000 | 3000 | 2000 |
| 2단 | 2500 | 2500 | 1800 |
| 3단 | 2500 | 2000 | 1500 |
| 4단 | 2000 | 2000 | 1500 |
| 5단 | 2000 | — | 1500 |

### 플릭 감도
| 파라미터 | 초기값 | 설명 |
|---|---|---|
| `MIN_FLICK_VELOCITY` | 300 px/s | 이 이하는 던지기로 인식 안 함 |
| `MAX_FLICK_VELOCITY` | 1500 px/s | 이 이상은 클램핑 |
| `SQUASH_SCALE` | 0.8 | 누를 때 돌 Y축 스케일 |
| `STRETCH_SCALE` | 1.3 | 발사 시 돌 Y축 스케일 |
| `STONE_PICK_RADIUS` | 30 px | 스와이프 시 돌 선택 판정 반경 |

## 기획 메모

### 남은 고민 포인트
- **모바일 최적화**: 터치 인터랙션이 핵심이므로 모바일 우선 설계 필수
- **2.5D 좌표 변환**: perspective 적용 시 터치 좌표 → 물리 좌표 매핑 검증 필요
